extends RefCounted

# Building behavior types
enum Behavior {
  GENERATOR,    # Produces resources over time
  PROCESSOR,    # Transforms input to output
  STORAGE,      # Holds resources
  CONSUMER,     # Uses resources for global effects
  HABIT,        # Runs automatically each day
  COPING,       # Activates reactively
  INFRASTRUCTURE,  # Roads, bridges
  GLOBAL_EFFECT    # Passive city-wide bonuses
}

static var definitions: Dictionary = {
  "road": {
    "id": "road",
    "name": "Road",
    "description": "Connects buildings, allowing workers to travel between them.",
    "behaviors": [Behavior.INFRASTRUCTURE],
    "build_cost": {"energy": 1},
    "size": Vector2i(1, 1),
    "color": Color(0.55, 0.52, 0.62),
    "unlocked_by_default": true,
    "ftue_unlock_day": 1,
  },

  "emotional_reservoir": {
    "id": "emotional_reservoir",
    "name": "Emotional Reservoir",
    "description": "A place to hold emotions until they can be processed.",
    "behaviors": [Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(2, 2),
    "color": Color(0.5, 0.6, 0.75),
    "storage_capacity": 20,
    "unlocked_by_default": true,
    "ftue_unlock_day": 1,
  },

  "memory_well": {
    "id": "memory_well",
    "name": "Memory Well",
    "description": "Generates Nostalgia periodically, which can become Joy or Grief.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.65, 0.55, 0.8),
    "generates": "nostalgia",
    "generation_rate": 0.2,
    "generation_amount": 1,
    "storage_capacity": 10,
    "unlocked_by_default": true,
    "ftue_unlock_day": 1,
    "synergy_hints": ["memory_processor", "mourning_chapel"],
  },

  "mourning_chapel": {
    "id": "mourning_chapel",
    "name": "Mourning Chapel",
    "description": "A quiet space to process grief into wisdom.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.45, 0.4, 0.6),
    "input": {"grief": 2},
    "output": {"wisdom": 1},
    "process_time": 4.0,
    "requires_worker": true,
    "storage_capacity": 12,
    "unlocked_by_default": true,
    "ftue_unlock_day": 3,
    "synergy_hints": ["memory_well", "wound"],
  },

  "morning_routine": {
    "id": "morning_routine",
    "name": "Morning Routine",
    "description": "Each day, generates a small amount of Calm and Energy.",
    "behaviors": [Behavior.HABIT, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 1),
    "color": Color(0.95, 0.85, 0.55),
    "habit_generates": {"calm": 2},
    "habit_energy_bonus": 1,
    "storage_capacity": 10,
    "unlocked_by_default": true,
    "ftue_unlock_day": 1,
    "synergy_hints": ["exercise_yard", "comfort_hearth"],
  },

  "comfort_hearth": {
    "id": "comfort_hearth",
    "name": "Comfort Hearth",
    "description": "Generates Calm slowly over time.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(1, 1),
    "color": Color(0.6, 0.8, 0.7),
    "generates": "calm",
    "generation_rate": 0.15,
    "generation_amount": 1,
    "storage_capacity": 5,
    "unlocked_by_default": true,
    "ftue_unlock_day": 1,
    "synergy_hints": ["morning_routine", "exercise_yard"],
  },

  "anxiety_diffuser": {
    "id": "anxiety_diffuser",
    "name": "Anxiety Diffuser",
    "description": "Slowly converts Anxiety into Calm.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.55, 0.75, 0.8),
    "input": {"anxiety": 2},
    "output": {"calm": 1},
    "process_time": 6.0,
    "requires_worker": false,
    "storage_capacity": 15,
    "unlocked_by_default": true,
    "ftue_unlock_day": 5,
    "synergy_hints": ["worry_loop"],
  },

  "emergency_calm_center": {
    "id": "emergency_calm_center",
    "name": "Emergency Calm Center",
    "description": "Activates when Anxiety spikes, rapidly converting it to Calm.",
    "behaviors": [Behavior.COPING, Behavior.STORAGE],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.4, 0.85, 0.75),
    "coping_trigger": "anxiety > 10",
    "coping_input": {"anxiety": 5},
    "coping_output": {"calm": 3},
    "coping_cooldown": 30.0,
    "storage_capacity": 15,
    "unlocked_by_default": false,
    "unlock_condition": {"belief": "calm_foundation"},
  },

  "reflection_pool": {
    "id": "reflection_pool",
    "name": "Reflection Pool",
    "description": "Converts negative thoughts into Insight.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.55, 0.7, 0.9),
    "input": {"worry": 2, "doubt": 1},
    "output": {"insight": 2},
    "process_time": 5.0,
    "requires_worker": true,
    "storage_capacity": 12,
    "unlocked_by_default": false,
    "synergy_hints": ["rumination_spiral", "inner_critic"],
  },

  "exercise_yard": {
    "id": "exercise_yard",
    "name": "Exercise Yard",
    "description": "Consumes Energy to reduce Tension and boost vitality.",
    "behaviors": [Behavior.HABIT, Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(2, 2),
    "color": Color(0.55, 0.8, 0.5),
    "habit_consumes": {"energy": 2},
    "habit_reduces": {"tension": 3},
    "habit_generates": {"calm": 1},
    "storage_capacity": 5,
    "unlocked_by_default": true,
    "ftue_unlock_day": 2,
    "synergy_hints": ["morning_routine", "comfort_hearth"],
  },

  "wound": {
    "id": "wound",
    "name": "Old Wound",
    "description": "A source of unprocessed pain. Slowly generates Grief that must be dealt with.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 0},
    "size": Vector2i(1, 1),
    "color": Color(0.35, 0.3, 0.5),
    "generates": "grief",
    "generation_rate": 0.12,
    "generation_amount": 1,
    "storage_capacity": 6,
    "unlocked_by_default": false,
    "synergy_hints": ["mourning_chapel"],
  },

  "worry_loop": {
    "id": "worry_loop",
    "name": "Worry Loop",
    "description": "Anxious thought patterns that generate Anxiety over time.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 0},
    "size": Vector2i(1, 1),
    "color": Color(0.55, 0.5, 0.65),
    "generates": "anxiety",
    "generation_rate": 0.18,
    "generation_amount": 1,
    "storage_capacity": 6,
    "unlocked_by_default": true,
    "ftue_unlock_day": 5,
    "synergy_hints": ["anxiety_diffuser", "grounding_station"],
  },

  "memory_processor": {
    "id": "memory_processor",
    "name": "Memory Processor",
    "description": "Transforms Nostalgia into Joy when Calm is present, or into Grief when Tension is present.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.75, 0.65, 0.85),
    "input": {"nostalgia": 2},
    "conditional_outputs": {
      "calm": {"output": "joy", "amount": 2},
      "tension": {"output": "grief", "amount": 2},
    },
    "output": {"grief": 1},
    "process_time": 4.0,
    "requires_worker": false,
    "storage_capacity": 12,
    "unlocked_by_default": true,
    "ftue_unlock_day": 7,
    "synergy_hints": ["memory_well"],
  },

  "rumination_spiral": {
    "id": "rumination_spiral",
    "name": "Rumination Spiral",
    "description": "Obsessive thought patterns that generate Worry. Left unchecked, Worry compounds on itself.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 0},
    "size": Vector2i(1, 1),
    "color": Color(0.5, 0.45, 0.6),
    "generates": "worry",
    "generation_rate": 0.14,
    "generation_amount": 1,
    "storage_capacity": 10,
    "unlocked_by_default": true,
    "ftue_unlock_day": 7,
    "synergy_hints": ["reflection_pool", "grounding_station"],
  },

  "grounding_station": {
    "id": "grounding_station",
    "name": "Grounding Station",
    "description": "Combines Worry and Calm to produce Insight through mindful awareness.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.5, 0.75, 0.7),
    "input": {"worry": 2, "calm": 1},
    "output": {"insight": 1},
    "process_time": 6.0,
    "requires_worker": false,
    "storage_capacity": 10,
    "unlocked_by_default": true,
    "ftue_unlock_day": 7,
    "synergy_hints": ["worry_loop", "rumination_spiral"],
  },

  "inner_critic": {
    "id": "inner_critic",
    "name": "Inner Critic",
    "description": "A harsh internal voice that generates Doubt, slowing nearby buildings.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 0},
    "size": Vector2i(1, 1),
    "color": Color(0.45, 0.4, 0.5),
    "generates": "doubt",
    "generation_rate": 0.12,
    "generation_amount": 1,
    "storage_capacity": 8,
    "unlocked_by_default": true,
    "ftue_unlock_day": 9,
    "synergy_hints": ["reflection_pool"],
  },

  # === GENERATION BUILDINGS ===

  "energy_spring": {
    "id": "energy_spring",
    "name": "Energy Spring",
    "description": "A wellspring of vitality. Provides bonus energy regeneration each day.",
    "behaviors": [Behavior.HABIT],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.3, 0.9, 0.5),
    "habit_energy_bonus": 2,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 3},
  },

  "emotion_fountain": {
    "id": "emotion_fountain",
    "name": "Emotion Fountain",
    "description": "A bubbling source of positive feelings. Randomly generates Joy, Love, or Hope.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.9, 0.7, 0.8),
    "generates": "joy",
    "generation_rate": 0.15,
    "generation_amount": 1,
    "storage_capacity": 12,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  "hope_beacon": {
    "id": "hope_beacon",
    "name": "Hope Beacon",
    "description": "A light in the darkness. Generates Hope faster when grief is nearby.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(1, 2),
    "color": Color(0.6, 0.9, 0.7),
    "generates": "hope",
    "generation_rate": 0.12,
    "generation_amount": 1,
    "generation_bonus_nearby": "grief",
    "generation_bonus_multiplier": 2.0,
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  "curiosity_garden": {
    "id": "curiosity_garden",
    "name": "Curiosity Garden",
    "description": "Wonder grows here. Generates more Curiosity when new buildings are placed nearby.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.7, 0.65, 0.95),
    "generates": "curiosity",
    "generation_rate": 0.18,
    "generation_amount": 1,
    "generation_bonus_new_building": true,
    "generation_bonus_duration": 10.0,
    "generation_bonus_multiplier": 1.5,
    "storage_capacity": 10,
    "unlocked_by_default": true,
    "ftue_unlock_day": 5,
  },

  "excitement_generator": {
    "id": "excitement_generator",
    "name": "Excitement Generator",
    "description": "A crackling source of anticipatory energy. Generates Excitement.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 1),
    "color": Color(1.0, 0.7, 0.3),
    "generates": "excitement",
    "generation_rate": 0.2,
    "generation_amount": 1,
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  "pride_monument": {
    "id": "pride_monument",
    "name": "Pride Monument",
    "description": "A tribute to achievements. Slowly generates Pride from accomplishments.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.85, 0.65, 0.25),
    "generates": "pride",
    "generation_rate": 0.1,
    "generation_amount": 1,
    "storage_capacity": 6,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 3},
  },

  "love_shrine": {
    "id": "love_shrine",
    "name": "Love Shrine",
    "description": "A sacred space honoring connection. Generates Love over time.",
    "behaviors": [Behavior.GENERATOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.95, 0.55, 0.65),
    "generates": "love",
    "generation_rate": 0.08,
    "generation_amount": 1,
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  # === PROCESSING BUILDINGS ===

  "anger_forge": {
    "id": "anger_forge",
    "name": "Anger Forge",
    "description": "Transforms raw Anger into Courage through controlled release.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.9, 0.35, 0.25),
    "input": {"anger": 3},
    "output": {"courage": 1},
    "process_time": 5.0,
    "requires_worker": true,
    "storage_capacity": 12,
    "unlocked_by_default": true,
    "ftue_unlock_day": 9,
  },

  "fear_processing_plant": {
    "id": "fear_processing_plant",
    "name": "Fear Processing Plant",
    "description": "Carefully distills Fear into Wisdom through understanding.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.55, 0.45, 0.65),
    "input": {"fear": 3},
    "output": {"wisdom": 1},
    "process_time": 7.0,
    "requires_worker": true,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  "shame_sanctuary": {
    "id": "shame_sanctuary",
    "name": "Shame Sanctuary",
    "description": "A gentle space to process Shame into self-compassion.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.65, 0.5, 0.7),
    "input": {"shame": 3},
    "output": {"comfort": 1, "insight": 1},
    "process_time": 8.0,
    "requires_worker": true,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 3},
  },

  "gratitude_converter": {
    "id": "gratitude_converter",
    "name": "Gratitude Converter",
    "description": "Transforms negative thoughts into appreciation through perspective shift.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.7, 0.85, 0.55),
    "input": {"worry": 2, "doubt": 1},
    "output": {"gratitude": 2},
    "process_time": 5.0,
    "requires_worker": false,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"wellbeing_tier": "stable"},
  },

  "integration_temple": {
    "id": "integration_temple",
    "name": "Integration Temple",
    "description": "A complex processor that synthesizes multiple emotions into Meaning.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 8},
    "size": Vector2i(3, 3),
    "color": Color(0.8, 0.65, 0.95),
    "input": {"wisdom": 1, "insight": 1, "gratitude": 1},
    "output": {"meaning": 1},
    "process_time": 12.0,
    "requires_worker": true,
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 5},
  },

  "tension_release": {
    "id": "tension_release",
    "name": "Tension Release",
    "description": "Physical processing that converts Tension into Calm.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 1),
    "color": Color(0.8, 0.5, 0.5),
    "input": {"tension": 3},
    "output": {"calm": 2},
    "process_time": 4.0,
    "requires_worker": false,
    "storage_capacity": 12,
    "unlocked_by_default": true,
    "ftue_unlock_day": 2,
  },

  "rumination_recycler": {
    "id": "rumination_recycler",
    "name": "Rumination Recycler",
    "description": "Breaks obsessive thought loops into useful Insight.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.55, 0.5, 0.55),
    "input": {"rumination": 3, "worry": 1},
    "output": {"insight": 1, "calm": 1},
    "process_time": 6.0,
    "requires_worker": true,
    "storage_capacity": 12,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  "despair_alchemist": {
    "id": "despair_alchemist",
    "name": "Despair Alchemist",
    "description": "The hardest transformation: turning Despair into Hope and Resilience.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 7},
    "size": Vector2i(2, 2),
    "color": Color(0.35, 0.3, 0.5),
    "input": {"despair": 2, "calm": 1},
    "output": {"hope": 1, "resilience": 1},
    "process_time": 10.0,
    "requires_worker": true,
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 4},
  },

  # === STORAGE BUILDINGS ===

  "memory_archive": {
    "id": "memory_archive",
    "name": "Memory Archive",
    "description": "Deep storage. Resources here don't stagnate, but purity decays 50% faster.",
    "behaviors": [Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.6, 0.55, 0.75),
    "storage_capacity": 30,
    "prevents_stagnation": true,
    "purity_decay_multiplier": 1.5,
    "unlocked_by_default": true,
    "ftue_unlock_day": 5,
  },

  "thought_library": {
    "id": "thought_library",
    "name": "Thought Library",
    "description": "Organized storage for thoughts and insights. Medium capacity.",
    "behaviors": [Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(2, 1),
    "color": Color(0.5, 0.6, 0.75),
    "storage_capacity": 18,
    "unlocked_by_default": true,
    "ftue_unlock_day": 3,
  },

  "quick_cache": {
    "id": "quick_cache",
    "name": "Quick Cache",
    "description": "Small, fast storage. Adjacent processors draw from here first and work 20% faster.",
    "behaviors": [Behavior.STORAGE],
    "build_cost": {"energy": 2},
    "size": Vector2i(1, 1),
    "color": Color(0.7, 0.75, 0.8),
    "storage_capacity": 8,
    "processor_priority": true,
    "processor_speed_bonus": 0.2,
    "unlocked_by_default": true,
    "ftue_unlock_day": 3,
  },

  "deep_storage": {
    "id": "deep_storage",
    "name": "Deep Storage",
    "description": "Vast underground repository. Very large capacity.",
    "behaviors": [Behavior.STORAGE],
    "build_cost": {"energy": 6},
    "size": Vector2i(3, 3),
    "color": Color(0.4, 0.45, 0.55),
    "storage_capacity": 50,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 3},
  },

  # === HABIT BUILDINGS ===

  "meditation_garden": {
    "id": "meditation_garden",
    "name": "Meditation Garden",
    "description": "Daily practice generates Calm and occasionally Insight.",
    "behaviors": [Behavior.HABIT, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.5, 0.75, 0.7),
    "habit_generates": {"calm": 3},
    "habit_reduces": {"anxiety": 2},
    "storage_capacity": 10,
    "unlocked_by_default": true,
    "ftue_unlock_day": 5,
    "synergy_hints": ["grounding_station", "journaling_corner"],
  },

  "journaling_corner": {
    "id": "journaling_corner",
    "name": "Journaling Corner",
    "description": "Daily writing processes emotions and generates Insight.",
    "behaviors": [Behavior.HABIT, Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(1, 2),
    "color": Color(0.8, 0.75, 0.6),
    "habit_generates": {"insight": 1},
    "habit_reduces": {"rumination": 2},
    "storage_capacity": 6,
    "unlocked_by_default": true,
    "ftue_unlock_day": 5,
    "synergy_hints": ["meditation_garden", "reflection_pool"],
  },

  "social_connection_hub": {
    "id": "social_connection_hub",
    "name": "Social Connection Hub",
    "description": "Maintains relationships. Generates Love and reduces Loneliness.",
    "behaviors": [Behavior.HABIT, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.9, 0.6, 0.65),
    "habit_generates": {"love": 2},
    "habit_reduces": {"loneliness": 3},
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  "creative_studio": {
    "id": "creative_studio",
    "name": "Creative Studio",
    "description": "A space for making things. Generates Joy and channels restless energy.",
    "behaviors": [Behavior.HABIT, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.9, 0.75, 0.5),
    "habit_generates": {"joy": 2},
    "habit_reduces": {"restlessness": 2, "boredom": 2},
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"wellbeing_tier": "stable"},
  },

  "sleep_chamber": {
    "id": "sleep_chamber",
    "name": "Sleep Chamber",
    "description": "Restful sanctuary. Provides bonus energy and reduces Fatigue.",
    "behaviors": [Behavior.HABIT],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.45, 0.5, 0.7),
    "habit_energy_bonus": 2,
    "habit_reduces": {"fatigue": 4},
    "unlocked_by_default": true,
    "ftue_unlock_day": 7,
  },

  "gratitude_practice": {
    "id": "gratitude_practice",
    "name": "Gratitude Practice",
    "description": "Daily appreciation generates Gratitude and Contentment.",
    "behaviors": [Behavior.HABIT, Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(1, 2),
    "color": Color(0.75, 0.85, 0.55),
    "habit_generates": {"gratitude": 2, "contentment": 1},
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 2},
  },

  "boundary_wall": {
    "id": "boundary_wall",
    "name": "Boundary Wall",
    "description": "Protective habit that reduces incoming negative emotions.",
    "behaviors": [Behavior.HABIT],
    "build_cost": {"energy": 4},
    "size": Vector2i(3, 1),
    "color": Color(0.6, 0.55, 0.5),
    "habit_reduces": {"anxiety": 1, "shame": 1, "doubt": 1},
    "unlocked_by_default": false,
    "unlock_condition": {"belief": "handle_difficulty"},
  },

  # === COPING BUILDINGS ===

  "anger_vent": {
    "id": "anger_vent",
    "name": "Anger Vent",
    "description": "Emergency release valve for Anger. Fast but produces Tension.",
    "behaviors": [Behavior.COPING, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(1, 2),
    "color": Color(0.95, 0.4, 0.3),
    "coping_trigger": "anger > 8",
    "coping_input": {"anger": 5},
    "coping_output": {"tension": 2},
    "coping_cooldown": 20.0,
    "storage_capacity": 10,
    "unlocked_by_default": true,
    "ftue_unlock_day": 7,
  },

  "comfort_den": {
    "id": "comfort_den",
    "name": "Comfort Den",
    "description": "A cozy retreat that generates Comfort when stress is high.",
    "behaviors": [Behavior.COPING, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.9, 0.8, 0.7),
    "coping_trigger": "tension > 8",
    "coping_input": {},
    "coping_output": {"comfort": 3},
    "coping_cooldown": 25.0,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 1},
  },

  "distraction_station": {
    "id": "distraction_station",
    "name": "Distraction Station",
    "description": "Quick relief from overwhelming feelings. Delays rather than processes.",
    "behaviors": [Behavior.COPING, Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(2, 1),
    "color": Color(0.7, 0.8, 0.9),
    "coping_trigger": "anxiety > 6 or grief > 6",
    "coping_input": {"anxiety": 3},
    "coping_output": {"calm": 1, "boredom": 1},
    "coping_cooldown": 15.0,
    "storage_capacity": 8,
    "unlocked_by_default": true,
    "ftue_unlock_day": 7,
  },

  "support_hotline": {
    "id": "support_hotline",
    "name": "Support Hotline",
    "description": "Connection in crisis. Rapidly reduces Loneliness and Despair.",
    "behaviors": [Behavior.COPING, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(1, 1),
    "color": Color(0.4, 0.7, 0.9),
    "coping_trigger": "loneliness > 6 or despair > 3",
    "coping_input": {"loneliness": 4, "despair": 2},
    "coping_output": {"love": 2, "hope": 1},
    "coping_cooldown": 30.0,
    "storage_capacity": 6,
    "unlocked_by_default": false,
    "unlock_condition": {"wellbeing_tier": "thriving"},
  },

  "grounding_chamber": {
    "id": "grounding_chamber",
    "name": "Grounding Chamber",
    "description": "Sensory reset for dissociation and panic. Returns to the present.",
    "behaviors": [Behavior.COPING, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 2),
    "color": Color(0.55, 0.65, 0.55),
    "coping_trigger": "fear > 8 or anxiety > 12",
    "coping_input": {"fear": 4, "anxiety": 4},
    "coping_output": {"calm": 3, "comfort": 1},
    "coping_cooldown": 25.0,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 3},
  },

  # === INFRASTRUCTURE BUILDINGS ===

  "bridge": {
    "id": "bridge",
    "name": "Bridge",
    "description": "Connects across gaps. Allows paths over obstacles.",
    "behaviors": [Behavior.INFRASTRUCTURE],
    "build_cost": {"energy": 2},
    "size": Vector2i(1, 1),
    "color": Color(0.6, 0.55, 0.5),
    "unlocked_by_default": true,
    "ftue_unlock_day": 3,
  },

  "highway": {
    "id": "highway",
    "name": "Highway",
    "description": "Faster travel path. Workers move quicker along highways.",
    "behaviors": [Behavior.INFRASTRUCTURE],
    "build_cost": {"energy": 2},
    "size": Vector2i(1, 1),
    "color": Color(0.65, 0.65, 0.6),
    "speed_multiplier": 1.5,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 2},
  },

  "attention_amplifier": {
    "id": "attention_amplifier",
    "name": "Attention Amplifier",
    "description": "+3 attention, but workers never habituate (attention costs stay high).",
    "behaviors": [Behavior.GLOBAL_EFFECT],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.85, 0.85, 0.4),
    "global_effect": {"attention_bonus": 3, "habituation_disabled": true},
    "unique": true,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 4},
  },

  # === GLOBAL EFFECT BUILDINGS ===

  "optimism_lens": {
    "id": "optimism_lens",
    "name": "Optimism Lens",
    "description": "Shifts perspective. Positive generation +25%, but only when wellbeing is above 40.",
    "behaviors": [Behavior.GLOBAL_EFFECT],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(1.0, 0.9, 0.5),
    "global_effect": {"positive_generation_multiplier": 1.25},
    "activation_condition": "wellbeing > 40",
    "unique": true,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 4},
  },

  "stoic_foundation": {
    "id": "stoic_foundation",
    "name": "Stoic Foundation",
    "description": "Reduces impact of negative emotions. Steady in turbulence.",
    "behaviors": [Behavior.GLOBAL_EFFECT],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.5, 0.55, 0.6),
    "global_effect": {"negative_impact_multiplier": 0.75},
    "unique": true,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 4},
  },

  "creative_core": {
    "id": "creative_core",
    "name": "Creative Core",
    "description": "Boosts habit buildings +50%, but processing runs 15% slower.",
    "behaviors": [Behavior.GLOBAL_EFFECT],
    "build_cost": {"energy": 7},
    "size": Vector2i(2, 2),
    "color": Color(0.95, 0.75, 0.55),
    "global_effect": {"habit_bonus_multiplier": 1.5, "processing_speed_multiplier": 0.85},
    "unique": true,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 5},
  },

  "compassion_center": {
    "id": "compassion_center",
    "name": "Compassion Center",
    "description": "Processing +30% faster, but only with a coping building nearby.",
    "behaviors": [Behavior.GLOBAL_EFFECT],
    "build_cost": {"energy": 7},
    "size": Vector2i(2, 2),
    "color": Color(0.9, 0.6, 0.7),
    "global_effect": {"processing_speed_multiplier": 1.3},
    "activation_condition": "coping_buildings > 0",
    "unique": true,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 5},
  },

  "resilience_monument": {
    "id": "resilience_monument",
    "name": "Resilience Monument",
    "description": "A testament to survival. Generates Resilience and reduces all negative decay.",
    "behaviors": [Behavior.GENERATOR, Behavior.GLOBAL_EFFECT, Behavior.STORAGE],
    "build_cost": {"energy": 8},
    "size": Vector2i(2, 3),
    "color": Color(0.6, 0.75, 0.85),
    "generates": "resilience",
    "generation_rate": 0.08,
    "generation_amount": 1,
    "global_effect": {"negative_decay_multiplier": 0.8},
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"event_reward": "the_rejection"},
  },

  "acceptance_shrine": {
    "id": "acceptance_shrine",
    "name": "Acceptance Shrine",
    "description": "Embracing what is. All emotions process more smoothly.",
    "behaviors": [Behavior.GLOBAL_EFFECT],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.75, 0.8, 0.85),
    "global_effect": {"processing_efficiency_multiplier": 1.2},
    "unique": true,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 4},
  },

  # === NEW PROCESSING BUILDINGS FOR ORPHAN RESOURCES ===

  "self_belief_forge": {
    "id": "self_belief_forge",
    "name": "Self-Belief Forge",
    "description": "Transforms Pride and Courage into lasting Resilience.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 6},
    "size": Vector2i(2, 2),
    "color": Color(0.85, 0.75, 0.45),
    "input": {"pride": 2, "courage": 1},
    "output": {"resilience": 1},
    "process_time": 8.0,
    "requires_worker": true,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 4},
  },

  "meaning_radiator": {
    "id": "meaning_radiator",
    "name": "Meaning Radiator",
    "description": "Meaning flows back into the system as Calm and Wisdom.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 7},
    "size": Vector2i(2, 2),
    "color": Color(0.9, 0.85, 0.95),
    "input": {"meaning": 1},
    "output": {"calm": 2, "wisdom": 1},
    "process_time": 10.0,
    "requires_worker": false,
    "storage_capacity": 6,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 5},
  },

  "excitement_channeler": {
    "id": "excitement_channeler",
    "name": "Excitement Channeler",
    "description": "Transforms raw Excitement into productive Curiosity and Energy.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 1),
    "color": Color(1.0, 0.75, 0.4),
    "input": {"excitement": 3},
    "output": {"curiosity": 2},
    "habit_energy_bonus": 1,
    "process_time": 4.0,
    "requires_worker": false,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 2},
  },

  "contentment_garden": {
    "id": "contentment_garden",
    "name": "Contentment Garden",
    "description": "Contentment deepens into Gratitude when nurtured.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.7, 0.85, 0.6),
    "input": {"contentment": 2},
    "output": {"gratitude": 1},
    "process_time": 6.0,
    "requires_worker": false,
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 3},
  },

  "confidence_anchor": {
    "id": "confidence_anchor",
    "name": "Confidence Anchor",
    "description": "Confidence crystallizes into Wisdom when reflected upon.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 5},
    "size": Vector2i(2, 1),
    "color": Color(0.8, 0.7, 0.5),
    "input": {"confidence": 3},
    "output": {"wisdom": 1},
    "process_time": 6.0,
    "requires_worker": false,
    "storage_capacity": 8,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 3},
  },

  "boredom_alchemist": {
    "id": "boredom_alchemist",
    "name": "Boredom Alchemist",
    "description": "Transmutes Boredom into Curiosity. Emptiness becomes possibility.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 3},
    "size": Vector2i(1, 2),
    "color": Color(0.6, 0.65, 0.75),
    "input": {"boredom": 2},
    "output": {"curiosity": 1},
    "process_time": 5.0,
    "requires_worker": false,
    "storage_capacity": 6,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 2},
  },

  "rest_sanctuary": {
    "id": "rest_sanctuary",
    "name": "Rest Sanctuary",
    "description": "Fatigue dissolves into Calm through deep rest.",
    "behaviors": [Behavior.PROCESSOR, Behavior.STORAGE],
    "build_cost": {"energy": 4},
    "size": Vector2i(2, 2),
    "color": Color(0.6, 0.7, 0.8),
    "input": {"fatigue": 3},
    "output": {"calm": 2},
    "process_time": 8.0,
    "requires_worker": false,
    "storage_capacity": 10,
    "unlocked_by_default": false,
    "unlock_condition": {"insight": 2},
  },
}

static func get_definition(building_id: String) -> Dictionary:
  return definitions.get(building_id, {})

static func get_all_unlocked() -> Array:
  var result = []
  for id in definitions:
    if definitions[id].get("unlocked_by_default", false):
      result.append(id)
  return result

static func get_unlocked_for_day(day: int) -> Array:
  var result = []
  for id in definitions:
    var def = definitions[id]
    if def.get("unlocked_by_default", false):
      var unlock_day = def.get("ftue_unlock_day", 1)
      if day >= unlock_day:
        result.append(id)
  return result

static func get_all_ids() -> Array:
  return definitions.keys()

static func get_all_definitions() -> Dictionary:
  return definitions
